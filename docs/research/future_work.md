# Future Work (미구현 기능)

이 문서는 설계는 완료되었으나 아직 구현되지 않은 기능들을 정리합니다.

---

## 1. Adaptive Top-K: per-token EMA baseline + entropy variance

### 1-1. K 업데이트 스킴 (기본 K 조정 방식)

| 항목           | 내용                                                                                                                                                                                              |
| ------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **기존 내용**    | 고정 Top-K (예: K=25) 또는 "토큰별: in-topk면 K–, out-of-topk면 K++" 스타일의 매우 로컬한 rule. K는 random walk처럼 출렁일 수 있음.                                                                                         |
| **개선본**      | - **쿼리 단위로 K 초기화** (예: K_init = 25).<br>- 토큰별 success(0/1)를 가지고 **EMA로 최근 성공률 (\hat r_i)** 계산.<br>- (\hat r_i > r^+)이면 K_baseline 감소, (\hat r_i < r^-)이면 K_baseline 증가 → **완만한 baseline K** 형성. |
| **개선 이유**    | - pure ±1 rule은 노이즈에 민감해 K가 토큰마다 출렁임.<br>- EMA는 최근 몇 토큰의 평균 패턴만 보고 움직이게 해서, "우연한 1~2토큰 mismatch"를 노이즈로 흡수.                                                                                      |
| **개선 기대 효과** | - K 변경이 **부드럽게** 이루어져 생성 안정성 확보.<br>- 시퀀스 전체 수준의 난이도/align 상태를 반영하는 **저주파 K 곡선**이 생김 → 분석과 디버깅이 쉬움.                                                                                             |
| **유의할 점**    | - EMA 계수(β), 임계값(r⁻, r⁺)을 너무 극단적으로 두면 baseline이 거의 안 움직이거나, 반대로 너무 민감해질 수 있음.<br>- success 정의(현재는 단순 top-k 기반, 나중에 s/max or top-p로 ablation 예정).                                                |

### 1-2. Entropy variance: K_eff = K_baseline + ΔK_entropy

| 항목           | 내용                                                                                                                                                                                                                     |
| ------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **기존 내용**    | K는 "학생이 잘 맞추냐/못 맞추냐"만 보고 조정. teacher가 얼마나 확신하는 위치인지(엔트로피)는 고려 X.                                                                                                                                                       |
| **개선본**      | - teacher 분포 엔트로피 H_i를 계산해 정규화 (\tilde H_i).<br>- (\Delta K_{\text{entropy}, i} = \gamma (2\tilde H_i - 1))를 정수 라운딩해서 **지역적 offset**으로 사용.<br>- 최종 Top-K는 `K_eff_i = clip(K_baseline_i + ΔK_entropy_i, K_min, K_max)`. |
| **개선 이유**    | - **지식 우위 구간**: teacher가 매우 샤프하게 확신 → H 낮음 → ΔK 음수 → K_eff 더 작아져서 teacher 분포를 강하게 따르게 함.<br>- **teacher도 애매한 구간**: H 높음 → ΔK 양수 → K_eff 커져 student를 더 관대하게 accept.                                                     |
| **개선 기대 효과** | - baseline은 노이즈를 평균내고, entropy variance는 "중요한 지점에서 튀는 반응" 제공.<br>- 문화 지식이 중요한 토큰(teacher 확신↑)에서 teacher 개입을 즉각 강하게 만들 수 있음.                                                                                            |
| **유의할 점**    | - γ(variance 크기)를 너무 크게 두면 baseline 의미가 사라질 수 있음 (±2~3 정도로 제한 추천).<br>- H_min/H_max 정규화는 실제 teacher 분포를 미리 샘플링해서 대략적인 범위를 잡아야 안정적.                                                                                     |

---

## 2. 데이터 혼합 비율 & 학습 스케줄 (실험 A/B/C)

### A 실험: 50 / 50 (culture : base)

| 항목           | 내용                                                                                                            |
| ------------ | ------------------------------------------------------------------------------------------------------------- |
| **기존 내용**    | 문화 데이터만 / 혹은 base 데이터 위주로만 SFT/KD → 한쪽에 과도하게 쏠릴 위험.                                                           |
| **개선본**      | - 배치 단위에서 culture 50%, base 50% 혼합.<br>- Adaptive K는 항상 ON (EMA baseline + entropy variance).                 |
| **개선 이유**    | - 첫 파일럿에서 **양쪽 성능 변화의 기본 스케일**을 보는 목적.<br>- teacher/student가 같은 패밀리이므로, 50/50이면 큰 붕괴 없이 지식 주입 경향을 확인하기 좋음.    |
| **개선 기대 효과** | - 한국 문화 벤치마크의 baseline 개선 정도, 일반 reasoning 성능 감소 정도를 동시에 관찰할 수 있는 "중립점" 확보.                                   |
| **유의할 점**    | - 문화 데이터가 매우 적다면 50/50로는 지식 주입 강도가 부족할 수 있음 → B 실험과 비교 필요.<br>- LR/step 수를 너무 공격적으로 잡으면, anchor 없이도 drift 가능. |

### B 실험: 70 / 30 (culture : base)

| 항목           | 내용                                                                                                                            |
| ------------ | ----------------------------------------------------------------------------------------------------------------------------- |
| **개선본**      | culture 70%, base 30% 고정 비율로 전체 학습 진행.                                                                                        |
| **개선 이유**    | - K-biscuit, K-click 등 **문화 벤치마크 향상을 좀 더 강하게 밀어보기 위한 세팅**.<br>- 50/50 결과를 보고 "성능 gain vs reasoning 손실" trade-off를 더 공격적으로 측정. |
| **개선 기대 효과** | - 문화 지식 성능 향상폭 증가 기대.<br>- 일반 reasoning 성능 감소 허용 가능한지 여부를 정량적으로 확인 가능.                                                        |
| **유의할 점**    | - anchor loss가 없는 풀 파인튜닝이라, LR/total step이 너무 크면 general reasoning 붕괴 위험 ↑.<br>- 이 실험은 반드시 50/50 결과와 **나란히** 해석해야 함.          |

### C 실험: 커리큘럼 (앞 70/30 → 뒤 30/70)

| 항목           | 내용                                                                                                                                    |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------- |
| **개선본**      | - 앞 2/3 스텝: culture 70%, base 30%.<br>- 뒤 1/3 스텝: culture 30%, base 70% (base "리커버리" 구간).                                             |
| **개선 이유**    | - 초반에 지식 주입을 세게 한 뒤, 후반에 base 데이터로 일반 reasoning을 부분 복구.<br>- "culture-heavy로 한 번 튄 뒤, base 데이터로 soft-regularization"에 해당.             |
| **개선 기대 효과** | - B에서 확인한 문화 성능 gain은 최대한 유지하면서, 일반 reasoning 성능을 50/50 수준에 더 가깝게 되돌릴 수 있을지 확인.<br>- 실제 실용 deployment 관점에서 가장 균형 잡힌 candidate가 될 가능성. |
| **유의할 점**    | - 후반 base 구간에서 "문화 지식이 되려 희석"될 위험도 있음 → A/B와 함께 비교 필요.<br>- 앞/뒤 스텝 비율(2/3 : 1/3)은 고정값이 아니라, 파일럿 결과를 보고 조정 가능한 하이퍼.                    |
